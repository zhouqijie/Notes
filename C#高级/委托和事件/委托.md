# 委托(delegate)    

委托是用户定义的一个类。    

> CRE：对方法的引用，类似C++函数指针。    

### 定义    

委托定义：  
`public delegate TR MyDel(T1, T2...)`    

委托变量的实例化：  
`MyDel del = new MyDel(method1)`(旧语法)（参数和返回值类型必须匹配）    
`MyDel del = method1`（C#2.0）  

### 多播    

> CRE：C#委托都是多播委托。    

> ？：委托是不可变的，使用+=、-=操作符是实际上创建了新的委托来赋给当前委托变量。    

方法的组合、新增、删除：  
`del = del1 + del2`  
`del += del1`  
`del -= del1`  



### 匿名方法    

普通匿名方法：`Mydel del = delegate (T1, T2){...}`    
Lambda表达式：`Mydel del = (T1, T2)=>{...}`    


### 常用委托Action<>和Func<>    

Action<>委托返回void类型，Func<>委托返回指定类型的值。    

> ?:实际上仅通过两种泛型委托就可以满足99% 的需求。    

<br />
<br />
<br />
<br />

# 事件(event)    

### 广播者和订阅者    

使用委托时一般会出现*广播者*和*订阅者*两个角色。  
**广播者**包含一个委托变量。它通过调用委托来决定什么时候广播。    
**订阅者**是方法目标的接收者。订阅者通过在委托上`+=/-=`来决定何时开启/结束监听。    

> CRE：标准的*观察者模式*。    


### 事件event    

事件就是将上述广播者和订阅者模式正式化的一个语言特性。它只暴露了所需的委托特性的部分子集。    
事件的主要目的就是防止订阅者之间互相干扰。event修饰的委托成员，在类中可以像委托一样访问，但在类外只能进行`+=/-=`操作。    

> ?：编译器会把事件转换为一个私有委托，以及实现`+=/-=`操作的public访问器。    
> CRE：Unity就是外部访问器AddListener和RemoveListener实现的自定义事件。    


(END)    